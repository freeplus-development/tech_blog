# ChatOpsなデプロイ環境（Github / Hubot / Slack / Circle Ci / Capistrano）

## 概要

こんにちは（こんばんわ？）最近犬派から猫派に転じたnisitomoです。
※26年間猫嫌いでしたが、ひょんなことから好き派に・・・

今携わっている案件ですが、リリース作業がまだ中途半端な自動化に留まっており
リリースブランチ作成して
develop→masterプルリク作って
capistranoコマンドをローカルで実行して・・・
となんか中途半端な感じでした・・・
やっとこさ、ChatOpsなデプロイ環境できたので、まとめます。下記概略図。

![chatopsな環境](https://s3-ap-northeast-1.amazonaws.com/freeplus-tech-blog/20171117/chatops_01.png)

## SlackからHubotを実行させる

### Hubotインストール

ここらへんを参考にまずは、ローカルでHubotが動く環境を構築
https://qiita.com/susuwatarin/items/019e0e701754161f7c4c

無事にローカルで動くことが確認できれば、herokuにデプロイしましょう！
下記pingと打って、PONGが返ってくればよし

```shell
up to date in 0.99s
wanko> [Fri Nov 17 2017 17:38:02 GMT+0900 (JST)] WARNING Loading scripts from hubot-scripts.json is deprecated and will be removed in 3.0 (https://github.com/github/hubot-scripts/issues/1113) in favor of packages for each script.

Your hubot-scripts.json is empty, so you just need to remove it.
[Fri Nov 17 2017 17:38:02 GMT+0900 (JST)] ERROR hubot-heroku-keepalive included, but missing HUBOT_HEROKU_KEEPALIVE_URL. `heroku config:set HUBOT_HEROKU_KEEPALIVE_URL=$(heroku apps:info -s | grep web.url | cut -d= -f2)`
[Fri Nov 17 2017 17:38:03 GMT+0900 (JST)] INFO hubot-redis-brain: Using default redis on localhost:6379

wanko> 
wanko> wanko ping
wanko> PONG
```

### Slack→Hubot

下記参考にしました。
https://qiita.com/bouzuya/items/2a200c9e8a45e2478bc2

integrationで、hubot urlをセットするところが現バージョンには見つかりませんでした。
